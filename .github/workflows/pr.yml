name: PR Verification

# This workflow runs branch verification checks on pull requests.
# It uses the ob-charts-tool to verify that the PR branch follows
# the required standards for chart versioning and structure.
#
# The workflow will:
# - Fail on critical errors (sequential versioning, build consistency)
# - Pass with warnings (non-critical issues like multiple packages modified)

on:
  pull_request:
    branches:
      - main
    paths-ignore:
      - 'docs/**'
      - '*.md'
      - '.gitignore'
      - 'CODEOWNERS'
      - 'LICENSE'

permissions:
  contents: read

jobs:
  verify-branch:
    name: Verify Branch State
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # Fetch full history to allow proper git diff with upstream
          fetch-depth: 0

      - name: Fetch ob-charts-tool
        run: ./dev-scripts/pull-scripts

      - name: Run branch verification
        run: |
          echo "Running branch verification on PR branch: ${{ github.head_ref }}"
          ./bin/ob-charts-tool branchVerifyCheck

      # The verification will automatically:
      # - Exit with code 0 if all critical checks pass (warnings are OK)
      # - Exit with code 1 if any critical check fails
